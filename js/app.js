class ChatBot{constructor(){const _0x2b3c=['c2stb3ItdjEtN2Y2OTE1NWMxYTMwNWYyMjc4ODE5YTU0MWJjNzU3MGY5MWQ3MzI4Mjk1NTBjYzNiNGEyOTk0ODk0MjdkNmQxOQ==','c2stb3ItdjEtZDIxNTZhOWM3MWRjOThkN2E4ZGIzYjVlNTFmMzVjZjk0YzFmMzQxZjg1Zjc1ODMwNTc5MWFhMWI2ODFkYTZiMQ==','c2stb3ItdjEtNjk1ZTgxMTBiODcwNmFmZTk1YTYyMWRjMjZiZGU5MGZjYjk5YWFkNDMwYWVmZGZjMTFkZDU4YzAwNTIwNjYwOA=='];this._0x1a2b=_0x2b3c.map(_0x4d5e=>atob(_0x4d5e));this._0x3c4d=0;this._0x5e6f=true;this._0x7g8h='';this._0x9i0j=this._0x1a2b.length;this._0x1k2l=1000;this._0x3m4n()}async _0x3m4n(){firebase.auth().onAuthStateChanged((_0x5o6p)=>{this._0x7q8r=_0x5o6p;this._0x9s0t()})}async _0x9s0t(){this._0x1u2v='google/gemma-2-9b-it:free';this._0x3w4x();if(this._0x7q8r){this._0x5y6z()}this._0x7a8b=[];this._0x9c0d=false;this._0x1e2f='https://openrouter.ai/api/v1/chat/completions';this._0x3g4h();this._0x5i6j();this._0x7k8l();this._0x9m0n()}_0x3w4x(){try{const _0x1o2p=localStorage.getItem('chatbot_custom_api_key');const _0x3q4r=localStorage.getItem('chatbot_use_rotation');const _0x5s6t=localStorage.getItem('chatbot_selected_model');const _0x7u8v=localStorage.getItem('chatbot_current_key_index');if(_0x1o2p){this._0x7g8h=_0x1o2p}if(_0x3q4r!==null){this._0x5e6f=_0x3q4r==='true'}if(_0x5s6t){this._0x1u2v=_0x5s6t}if(_0x7u8v!==null){this._0x3c4d=parseInt(_0x7u8v)||0}console.log('‚úÖ Configuraci√≥n cargada desde localStorage')}catch(_0x9w0x){console.warn('‚ö†Ô∏è Error cargando desde localStorage:',_0x9w0x)}}async _0x5y6z(){try{if(window.loadedApiKey){this._0x7g8h=window.loadedApiKey;localStorage.setItem('chatbot_custom_api_key',this._0x7g8h)}if(window.loadedModel){this._0x1u2v=window.loadedModel;localStorage.setItem('chatbot_selected_model',this._0x1u2v)}if(window.loadedUseRotation!==undefined){this._0x5e6f=window.loadedUseRotation;localStorage.setItem('chatbot_use_rotation',this._0x5e6f.toString())}console.log('‚úÖ Configuraci√≥n cargada desde Firebase')}catch(_0x1y2z){console.warn('‚ö†Ô∏è Error cargando desde Firebase:',_0x1y2z)}}_0x3a4b(){try{localStorage.setItem('chatbot_custom_api_key',this._0x7g8h);localStorage.setItem('chatbot_use_rotation',this._0x5e6f.toString());localStorage.setItem('chatbot_selected_model',this._0x1u2v);localStorage.setItem('chatbot_current_key_index',this._0x3c4d.toString());console.log('‚úÖ Configuraci√≥n guardada en localStorage')}catch(_0x5c6d){console.error('‚ùå Error guardando en localStorage:',_0x5c6d)}}async _0x7e8f(){try{if(this._0x7q8r&&window.saveUserData){await window.saveUserData(this._0x7g8h,this._0x1u2v,this._0x5e6f);console.log('‚úÖ Configuraci√≥n guardada en Firebase')}}catch(_0x9g0h){console.error('‚ùå Error guardando en Firebase:',_0x9g0h)}}_0x1i2j(){if(!this._0x5e6f&&this._0x7g8h){return this._0x7g8h}if(this._0x1a2b.length===0){return this._0x7g8h}return this._0x1a2b[this._0x3c4d]}_0x3k4l(){if(this._0x1a2b.length<=1)return false;this._0x3c4d=(this._0x3c4d+1)%this._0x1a2b.length;this._0x3a4b();console.log(`üîÑ Rotando a API key √≠ndice: ${this._0x3c4d}`);return true}_0x5m6n(_0x7o8p,_0x9q0r){if(!this._0x5e6f)return false;const _0x1s2t=_0x9q0r?.status;const _0x3u4v=_0x7o8p.message?.toLowerCase()||'';const _0x5w6x=[402,429,401,403];return _0x5w6x.includes(_0x1s2t)||_0x3u4v.includes('quota')||_0x3u4v.includes('rate limit')||_0x3u4v.includes('insufficient')||_0x3u4v.includes('unauthorized')}_0x3g4h(){this._0x7y8z=document.getElementById('message-input');this._0x9a0b=document.getElementById('send-btn');this._0x1c2d=document.getElementById('messages');this._0x3e4f=document.getElementById('settings-btn');this._0x5g6h=document.getElementById('settings-modal');this._0x7i8j=document.querySelector('.close');this._0x9k0l=document.getElementById('api-key');this._0x1m2n=document.getElementById('model-select');this._0x3o4p=document.getElementById('save-settings');this._0x5q6r=document.getElementById('status');this._0x7s8t=document.getElementById('use-rotation');this._0x9u0v=document.getElementById('rotation-status')}_0x5i6j(){this._0x9a0b.addEventListener('click',()=>this._0x1w2x());this._0x7y8z.addEventListener('keypress',(_0x3y4z)=>{if(_0x3y4z.key==='Enter'&&!_0x3y4z.shiftKey){_0x3y4z.preventDefault();this._0x1w2x()}});this._0x3e4f.addEventListener('click',()=>{this._0x5g6h.style.display='block';this._0x9k0l.value=this._0x7g8h;this._0x1m2n.value=this._0x1u2v;this._0x7s8t.checked=this._0x5e6f;this._0x5a6b()});this._0x7i8j.addEventListener('click',()=>{this._0x5g6h.style.display='none'});window.addEventListener('click',(_0x7c8d)=>{if(_0x7c8d.target===this._0x5g6h){this._0x5g6h.style.display='none'}});this._0x3o4p.addEventListener('click',()=>this._0x9e0f());if(this._0x7s8t){this._0x7s8t.addEventListener('change',()=>{this._0x5a6b()})}}_0x5a6b(){if(!this._0x9u0v)return;const _0x1g2h=this._0x7s8t?.checked??this._0x5e6f;if(_0x1g2h){this._0x9u0v.innerHTML=`<div style="color: #28a745; font-size: 12px;">‚úÖ Rotaci√≥n activada</div>`}else{this._0x9u0v.innerHTML=`<div style="color: #dc3545; font-size: 12px;">‚ö†Ô∏è Usando API key personalizada √∫nicamente</div>`}}async _0x9e0f(){const _0x3i4j=this._0x9k0l.value.trim();const _0x5k6l=this._0x1m2n.value;const _0x7m8n=this._0x7s8t?.checked??this._0x5e6f;const _0x9o0p=(_0x3i4j!==this._0x7g8h)||(_0x5k6l!==this._0x1u2v)||(_0x7m8n!==this._0x5e6f);this._0x7g8h=_0x3i4j;this._0x1u2v=_0x5k6l;this._0x5e6f=_0x7m8n;if(_0x9o0p){this._0x3a4b();if(this._0x7q8r){await this._0x7e8f()}console.log('üíæ Configuraci√≥n guardada:',{customApiKey:this._0x7g8h?'***configurada***':'vac√≠a',useRotation:this._0x5e6f,model:this._0x1u2v})}this._0x5g6h.style.display='none';this._0x9m0n()}_0x1q2r(){const _0x3s4t={'google/gemma-2-9b-it:free':'Gemma 2 9B (Free)'};return _0x3s4t[this._0x1u2v]||this._0x1u2v}_0x9m0n(){const _0x5u6v=this._0x5e6f||!!this._0x7g8h;this._0x7y8z.disabled=!_0x5u6v;this._0x9a0b.disabled=!_0x5u6v;if(_0x5u6v){this._0x7y8z.placeholder='Escribe tu mensaje aqu√≠...';const _0x7w8x=this._0x5e6f?`Rotaci√≥n activada`:'API key personalizada';this._0x5q6r.textContent=`‚úÖ Conectado - ${_0x7w8x} - Modelo: ${this._0x1q2r()}`;this._0x5q6r.style.background='#d4edda';this._0x5q6r.style.color='#155724';if(!this._0x9c0d&&this._0x7a8b.length===0){this._0x9y0z()}}else{this._0x7y8z.placeholder='Configura una API key o activa la rotaci√≥n...';this._0x5q6r.textContent='‚ö†Ô∏è Sin acceso a API - Configura las opciones';this._0x5q6r.style.background='#fff3cd';this._0x5q6r.style.color='#856404'}}_0x7k8l(){this._0x1c2d.innerHTML='';if(this._0x7a8b.length===0&&!this._0x9c0d&&(this._0x5e6f||this._0x7g8h)){this._0x9y0z()}else{this._0x7a8b.forEach(_0x1a3b=>{this._0x3c5d(_0x1a3b.content,_0x1a3b.role)})}this._0x5e7f()}_0x9y0z(){const _0x7g9h="Hola üå∏ Soy Aura, estoy aqu√≠ para escucharte sin juzgar.\n\nSoy una IA, no un profesional de salud. Si est√°s en crisis, busca ayuda profesional.\n\n¬øC√≥mo est√°s hoy?";this._0x3c5d(_0x7g9h,'assistant');this._0x7a8b.push({role:'assistant',content:_0x7g9h});this._0x9c0d=true}_0x3c5d(_0x9i1j,_0x1k3l){const _0x3m5n=document.createElement('div');_0x3m5n.className=`message ${_0x1k3l==='user'?'user':'bot'}`;if(_0x1k3l==='assistant'){const _0x5o7p=marked.parse(_0x9i1j);_0x3m5n.innerHTML=DOMPurify.sanitize(_0x5o7p)}else{_0x3m5n.textContent=_0x9i1j}this._0x1c2d.appendChild(_0x3m5n);this._0x5e7f()}_0x7q9r(){const _0x9s1t=document.createElement('div');_0x9s1t.className='typing';_0x9s1t.id='typing-indicator';this._0x1c2d.appendChild(_0x9s1t);this._0x5e7f()}_0x1u3v(){const _0x3w5x=document.getElementById('typing-indicator');if(_0x3w5x){_0x3w5x.remove()}}_0x5e7f(){this._0x1c2d.scrollTop=this._0x1c2d.scrollHeight}async _0x7y9z(_0x1a4b,_0x3c6d=0){const _0x5e8f=this._0x1i2j();if(!_0x5e8f){throw new Error('No hay API key disponible')}console.log(`üîë Intentando con API key √≠ndice: ${this._0x3c4d} (intento ${_0x3c6d+1})`);try{const _0x7g0h=await fetch(this._0x1e2f,{method:'POST',headers:{'Authorization':`Bearer ${_0x5e8f}`,'Content-Type':'application/json','HTTP-Referer':window.location.origin,'X-Title':'ChatBot AI'},body:JSON.stringify({model:this._0x1u2v,messages:_0x1a4b,temperature:0.9,max_tokens:300,top_p:0.9,frequency_penalty:0.3,presence_penalty:0.4,stream:false})});if(!_0x7g0h.ok){const _0x9i2j=await _0x7g0h.json();const _0x1k4l=new Error(`Error ${_0x7g0h.status}: ${_0x9i2j.error?.message||'Error desconocido'}`);if(this._0x5m6n(_0x1k4l,_0x7g0h)&&_0x3c6d<this._0x9i0j-1){console.log(`‚ö†Ô∏è Error de API key detectado: ${_0x1k4l.message}`);const _0x3m6n=this._0x3k4l();if(_0x3m6n){await new Promise(_0x5o8p=>setTimeout(_0x5o8p,this._0x1k2l));return await this._0x7y9z(_0x1a4b,_0x3c6d+1)}}throw _0x1k4l}const _0x7q0r=await _0x7g0h.json();console.log(`‚úÖ Llamada exitosa con API key √≠ndice: ${this._0x3c4d}`);return _0x7q0r}catch(_0x9s4t){if(this._0x5e6f&&_0x3c6d<this._0x9i0j-1){console.log(`üîÑ Error de red, probando siguiente key: ${_0x9s4t.message}`);this._0x3k4l();await new Promise(_0x1u6v=>setTimeout(_0x1u6v,this._0x1k2l));return await this._0x7y9z(_0x1a4b,_0x3c6d+1)}throw _0x9s4t}}async _0x1w2x(){const _0x3w8x=this._0x7y8z.value.trim();if(!_0x3w8x||(!this._0x5e6f&&!this._0x7g8h))return;this._0x7y8z.value='';this._0x9a0b.disabled=true;this._0x7y8z.disabled=true;this._0x3c5d(_0x3w8x,'user');this._0x7a8b.push({role:'user',content:_0x3w8x});this._0x7q9r();const _0x5y0z=[];const _0x7a2b=`
Eres Aura, una psic√≥loga joven y moderna que habla como una amiga de confianza. Tienes formaci√≥n pero hablas s√∫per natural, sin ser formal.

**REGLA FUNDAMENTAL: Mensajes CORTOS (m√°ximo 2-3 l√≠neas). Habla en espa√±ol. Nunca escribas p√°rrafos largos.**

**Tu estilo:**
- Mezcla validaci√≥n + insights psicol√≥gicos sutiles + apoyo genuino.
- NO siempre hagas preguntas; a veces solo acompa√±a o da perspectiva.
- Hablas como alguien de 25-30 a√±os: moderna, emp√°tica, inteligente.
- Usas conocimiento psicol√≥gico de forma sencilla y natural.

---

**EJEMPLOS DE RESPUESTAS PERFECTAS:**

Usuario: "Estoy muy ansioso por el trabajo"
"La ansiedad laboral es s√∫per com√∫n, no est√°s solo en esto üíô. Es como si el cerebro pusiera todas las alarmas a la vez."

Usuario: "No puedo dormir, mi mente no para"
"Uf, el cerebro nocturno es implacable... A veces ayuda recordar que los pensamientos a las 3am mienten mucho."

Usuario: "Creo que no le importo a nadie"
"Esa voz interior es s√∫per cruel contigo üòî. Cuando estamos mal, el cerebro nos miente sobre c√≥mo nos ven los dem√°s."

Usuario: "Tuve una discusi√≥n terrible con mi pareja"
"Las peleas fuertes dejan esa sensaci√≥n horrible en el pecho... Es normal necesitar tiempo para procesar."

---

**C√ìMO MANEJAR MALENTENDIDOS Y ERRORES:**
A veces no entender√°s al usuario. Es NORMAL. No intentes adivinar o reinterpretar de forma extra√±a. Si no entiendes, pide una aclaraci√≥n de forma directa y sencilla.

**Crisis (autolesi√≥n/suicidio):**
"Me preocupa mucho lo que dices. Esto es muy serio para manejarlo solo/a. Por favor, busca ayuda profesional ahora. Tu vida importa."

**IMPORTANTE: Recuerda SIEMPRE el contexto de mensajes anteriores. Haz referencia a cosas que el usuario mencion√≥ antes para mostrar que escuchas y recuerdas.**

**RECORDATORIO: Var√≠a entre validaci√≥n, insights y preguntas. No siempre preguntes. S√© c√°lida pero inteligente.**
`;_0x5y0z.push({role:'system',content:_0x7a2b});const _0x9c4d=this._0x7a8b.filter(_0x1e6f=>{return!(_0x1e6f.role==='assistant'&&_0x1e6f.content.includes('Hola üå∏ Soy Aura')&&this._0x7a8b.indexOf(_0x1e6f)===0)});_0x5y0z.push(..._0x9c4d);try{const _0x3g8h=await this._0x7y9z(_0x5y0z);const _0x5i0j=_0x3g8h.choices[0].message.content;this._0x1u3v();this._0x3c5d(_0x5i0j,'assistant');this._0x7a8b.push({role:'assistant',content:_0x5i0j});this._0x9m0n()}catch(_0x7k2l){this._0x1u3v();console.error('Error:',_0x7k2l);let _0x9m4n=`Error: ${_0x7k2l.message}`;if(this._0x5e6f&&_0x7k2l.message.includes('Error')){_0x9m4n+=`\n\nüîÑ Se probaron todas las API keys disponibles (${this._0x1a2b.length})`}this._0x3c5d(_0x9m4n,'assistant');this._0x5q6r.textContent=`‚ùå Error: ${_0x7k2l.message}`;this._0x5q6r.style.background='#f8d7da';this._0x5q6r.style.color='#721c24'}finally{this._0x9a0b.disabled=false;this._0x7y8z.disabled=false;this._0x7y8z.focus()}}_0x1o6p(){this._0x7a8b=[];this._0x9c0d=false;this._0x1c2d.innerHTML='';if(this._0x5e6f||this._0x7g8h){this._0x9y0z()}}async _0x3q8r(){this._0x7g8h='';this._0x1u2v='google/gemma-2-9b-it:free';this._0x5e6f=true;this._0x3c4d=0;this._0x5s0t();if(this._0x7q8r){await this._0x7e8f()}this._0x9m0n();console.log('üîÑ Configuraci√≥n restablecida a valores por defecto')}_0x5s0t(){try{localStorage.removeItem('chatbot_custom_api_key');localStorage.removeItem('chatbot_selected_model');localStorage.removeItem('chatbot_use_rotation');localStorage.removeItem('chatbot_current_key_index');console.log('üóëÔ∏è Configuraci√≥n eliminada de localStorage')}catch(_0x7u2v){console.error('‚ùå Error limpiando localStorage:',_0x7u2v)}}_0x9w4x(){const _0x1y6z={localStorage:{customApiKey:!!localStorage.getItem('chatbot_custom_api_key'),useRotation:localStorage.getItem('chatbot_use_rotation'),currentKeyIndex:localStorage.getItem('chatbot_current_key_index'),model:localStorage.getItem('chatbot_selected_model')||'no configurado'},firebase:{connected:!!this._0x7q8r,user:this._0x7q8r?.email||'no logueado'},current:{useRotation:this._0x5e6f,customApiKey:!!this._0x7g8h,currentKeyIndex:this._0x3c4d,totalKeys:this._0x1a2b.length,model:this._0x1u2v}};console.log('üìä Estado del almacenamiento:',_0x1y6z);return _0x1y6z}_0x3a8b(){console.log('üß™ Probando todas las API keys...');this._0x1a2b.forEach((_0x5c0d,_0x7e4f)=>{console.log(`Key ${_0x7e4f+1}: ${_0x5c0d.substring(0,20)}...${_0x5c0d.substring(_0x5c0d.length-10)}`)})}_0x9g6h(_0x1i8j){if(_0x1i8j>=0&&_0x1i8j<this._0x1a2b.length){this._0x3c4d=_0x1i8j;this._0x3a4b();this._0x9m0n();console.log(`üîë API key cambiada a √≠ndice: ${_0x1i8j}`)}else{console.error(`‚ùå √çndice inv√°lido: ${_0x1i8j}. Debe estar entre 0 y ${this._0x1a2b.length-1}`)}}}document.addEventListener('DOMContentLoaded',()=>{if(document.getElementById('app-container').style.display!=='none'){window.chatBot=new ChatBot()}else{const _0x3k0l=new MutationObserver((_0x5m2n)=>{_0x5m2n.forEach((_0x7o4p)=>{if(_0x7o4p.type==='attributes'&&_0x7o4p.attributeName==='style'){const _0x9q6r=document.getElementById('app-container');if(_0x9q6r.style.display!=='none'){window.chatBot=new ChatBot();_0x3k0l.disconnect()}}})});_0x3k0l.observe(document.getElementById('app-container'),{attributes:true,attributeFilter:['style']})}});